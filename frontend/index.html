<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansun - åŠ å¯†è´§å¸èµ„è®¯</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0d1117; color: #c9d1d9; min-height: 100vh; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid #30363d; margin-bottom: 16px; }
        header h1 { font-size: 1.4rem; font-weight: 700; background: linear-gradient(135deg, #58a6ff, #8b949e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .lang-select { padding: 6px 10px; border-radius: 6px; border: 1px solid #30363d; background: #21262d; color: #c9d1d9; cursor: pointer; }
        .ai-section { background: linear-gradient(145deg, #21262d, #161b22); border: 1px solid #30363d; border-radius: 12px; padding: 14px; margin-bottom: 16px; }
        .ai-header { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
        .ai-chat { background: #0d1117; border-radius: 8px; padding: 10px; min-height: 80px; max-height: 150px; overflow-y: auto; margin-bottom: 10px; }
        .ai-message.assistant .bubble { background: #21262d; border: 1px solid #30363d; padding: 8px 12px; border-radius: 10px; border-bottom-left-radius: 4px; font-size: 0.85rem; display: inline-block; max-width: 95%; }
        .ai-input-group { display: flex; gap: 8px; }
        .ai-input-group input { flex: 1; padding: 10px 14px; border-radius: 8px; border: 1px solid #30363d; background: #0d1117; color: #c9d1d9; }
        .ai-input-group button { padding: 10px 18px; border-radius: 8px; border: none; background: #238636; color: #fff; font-weight: 600; cursor: pointer; }
        
        .signal-card { background: linear-gradient(145deg, #21262d, #161b22); border: 1px solid #30363d; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
        .signal-main { display: flex; align-items: center; gap: 14px; margin-bottom: 14px; }
        .signal-icon { width: 56px; height: 56px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 26px; background: #21262d; }
        .signal-buy .signal-icon { background: rgba(63, 185, 80, 0.2); }
        .signal-sell .signal-icon { background: rgba(248, 81, 73, 0.2); }
        .signal-hold .signal-icon { background: rgba(139, 148, 158, 0.2); }
        .signal-info { flex: 1; }
        .signal-title { font-size: 0.8rem; color: #8b949e; margin-bottom: 2px; }
        .signal-recommendation { font-size: 1.5rem; font-weight: 700; }
        .signal-buy .signal-recommendation { color: #3fb950; }
        .signal-sell .signal-recommendation { color: #f85149; }
        .signal-hold .signal-recommendation { color: #8b949e; }
        .signal-desc { font-size: 0.8rem; color: #8b949e; margin-top: 2px; }
        .signal-data-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 14px; }
        .data-item { background: #0d1117; border-radius: 8px; padding: 12px; text-align: center; }
        .data-label { font-size: 0.75rem; color: #8b949e; margin-bottom: 6px; }
        .data-value { font-size: 1rem; font-weight: 700; }
        .data-value.up { color: #3fb950; }
        .data-value.down { color: #f85149; }
        .data-sub { font-size: 0.7rem; color: #8b949e; margin-top: 4px; }
        .why-box { background: #21262d; border-radius: 8px; padding: 12px; margin-bottom: 12px; }
        .why-title { font-weight: 600; font-size: 0.85rem; margin-bottom: 10px; color: #58a6ff; }
        .why-item { font-size: 0.85rem; color: #c9d1d9; margin-bottom: 8px; padding-left: 20px; position: relative; }
        .why-item::before { content: 'â†’'; position: absolute; left: 0; color: #58a6ff; }
        .signal-footer { display: flex; justify-content: space-between; font-size: 0.75rem; color: #8b949e; padding-top: 10px; border-top: 1px solid #21262d; }
        
        .quick-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px; }
        .quick-stat { background: #161b22; border: 1px solid #30363d; border-radius: 10px; padding: 12px; text-align: center; }
        .quick-stat:hover { border-color: #58a6ff; }
        .quick-stat .icon { font-size: 1.5rem; margin-bottom: 6px; }
        .quick-stat .label { font-size: 0.8rem; color: #8b949e; }
        .quick-stat .value { font-size: 0.9rem; font-weight: 600; margin-top: 4px; }
        .quick-stat .sub { font-size: 0.7rem; color: #f85149; }
        
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } .quick-stats { grid-template-columns: repeat(2, 1fr); } .signal-data-grid { grid-template-columns: 1fr; } }
        .section-card { background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 14px; margin-bottom: 16px; }
        .section-title { font-size: 0.95rem; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 6px; }
        .market-header { display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
        .market-pill { display: flex; align-items: center; gap: 6px; padding: 6px 10px; background: #21262d; border-radius: 6px; }
        .market-pill .label { color: #8b949e; font-size: 0.75rem; }
        .market-pill .value { font-weight: 600; font-size: 0.85rem; }
        .up { color: #3fb950; background: rgba(63, 185, 80, 0.2); }
        .down { color: #f85149; background: rgba(248, 81, 73, 0.2); }
        .coin-table { width: 100%; border-collapse: collapse; }
        .coin-table th { text-align: left; padding: 8px; color: #8b949e; font-size: 0.75rem; border-bottom: 1px solid #30363d; }
        .coin-table td { padding: 10px 8px; border-bottom: 1px solid #21262d; }
        .coin-info { display: flex; align-items: center; gap: 8px; }
        .coin-info img { width: 24px; height: 24px; border-radius: 50%; }
        .coin-info .name { font-weight: 600; font-size: 0.85rem; }
        .coin-info .symbol { color: #8b949e; font-size: 0.75rem; }
        .coin-price { font-weight: 600; font-size: 0.9rem; }
        .coin-change { font-size: 0.8rem; font-weight: 500; padding: 2px 6px; border-radius: 4px; }
        .coin-rank { color: #8b949e; font-size: 0.8rem; }
        
        .news-card { background: #21262d; border-radius: 8px; padding: 12px; margin-bottom: 8px; }
        .news-card:hover { background: #30363d; cursor: pointer; }
        .news-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .news-source { background: #238636; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: 600; color: #fff; }
        .news-time { color: #8b949e; font-size: 0.75rem; }
        .news-card h4 { font-size: 0.9rem; font-weight: 600; line-height: 1.4; margin-bottom: 4px; }
        .news-card h4 a { color: #c9d1d9; text-decoration: none; }
        .news-card p { font-size: 0.8rem; color: #8b949e; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .loading { text-align: center; padding: 16px; color: #8b949e; font-size: 0.85rem; }
        footer { text-align: center; padding: 16px; border-top: 1px solid #30363d; color: #8b949e; font-size: 0.8rem; margin-top: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <header><h1>Ansun</h1><select class="lang-select"><option value="zh">ä¸­æ–‡</option><option value="en">English</option></select></header>
        
        <div class="ai-section">
            <div class="ai-header"><span>ğŸ¤–</span><h2>AIæ™ºèƒ½åŠ©æ‰‹</h2></div>
            <div class="ai-chat"><div class="ai-message assistant"><div class="bubble">ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¸åœˆé—®é¢˜å¯ä»¥é—®æˆ‘ï½</div></div></div>
            <div class="ai-input-group"><input type="text" id="aiInput" placeholder="è¾“å…¥é—®é¢˜..."><button onclick="askAI()">å‘é€</button></div>
        </div>
        
        <div class="signal-card">
            <div class="section-title">ğŸ“ˆ AIå¸‚åœºä¿¡å· <select id="coinSelect" style="margin-left:8px;padding:4px 8px;font-size:0.8rem" onchange="updateSignal()"><option value="BTC">BTC</option><option value="ETH">ETH</option><option value="SOL">SOL</option><option value="BNB">BNB</option><option value="XRP">XRP</option><option value="ADA">ADA</option><option value="DOGE">DOGE</option><option value="AVAX">AVAX</option></select></div>
            <div class="signal-main" id="signalMain">
                <div class="signal-icon" id="signalIcon">ğŸ“Š</div>
                <div class="signal-info">
                    <div class="signal-title">AIå»ºè®®</div>
                    <div class="signal-recommendation" id="signalRec">-</div>
                    <div class="signal-desc" id="signalDesc">-</div>
                </div>
            </div>
            <div class="signal-data-grid">
                <div class="data-item"><div class="data-label">ğŸ‹ å·¨é²¸èµ„é‡‘</div><div class="data-value" id="whaleNet">-</div><div class="data-sub" id="whaleDetail">-</div></div>
                <div class="data-item"><div class="data-label">ğŸ“° æ–°é—»æƒ…ç»ª</div><div class="data-value" id="sentiment">-</div><div class="data-sub" id="sentimentDetail">-</div></div>
                <div class="data-item"><div class="data-label">ğŸ’° ä»·æ ¼è¶‹åŠ¿</div><div class="data-value" id="price">-</div><div class="data-sub" id="priceDetail">-</div></div>
            </div>
            <div class="why-box"><div class="why-title">ğŸ“‹ AIåˆ†æç†ç”±</div><div id="signalWhy">-</div></div>
            <div class="signal-footer"><span id="confidence">AIç½®ä¿¡åº¦: -</span><span id="updateTime">æ›´æ–°æ—¶é—´: -</span></div>
        </div>
        
        <div class="quick-stats">
            <div class="quick-stat"><div class="icon">ğŸ””</div><div class="label">ä»£å¸è§£é”</div><div class="value" id="unlockCount">-</div><div class="sub">æœ¬æœˆ</div></div>
            <div class="quick-stat"><div class="icon">ğŸ”¥</div><div class="label">çƒ­é—¨æ¦‚å¿µ</div><div class="value" id="narrativeCount">-</div><div class="sub">è¶‹åŠ¿</div></div>
            <div class="quick-stat"><div class="icon">ğŸ“Š</div><div class="label">DeFi TVL</div><div class="value" id="tvlValue">-</div><div class="sub">é“¾ä¸Š</div></div>
            <div class="quick-stat"><div class="icon">ğŸ‹</div><div class="label">å·¨é²¸è¿½è¸ª</div><div class="value" id="whaleCount">-</div><div class="sub">æ´»è·ƒ</div></div>
        </div>
        
        <div class="main-grid">
            <div>
                <div class="section-card">
                    <div class="section-title">ğŸ“Š å®æ—¶è¡Œæƒ…</div>
                    <div class="market-header" id="marketHeader"><div class="loading">åŠ è½½ä¸­...</div></div>
                    <table class="coin-table"><thead><tr><th>#</th><th>å¸ç§</th><th>ä»·æ ¼</th><th>24h</th><th>7d</th></tr></thead><tbody id="coinTable"><tr><td colspan="5" class="loading">åŠ è½½ä¸­...</td></tr></tbody></table>
                </div>
            </div>
            <div>
                <div class="section-card">
                    <div class="section-title">ğŸ“° æœ€æ–°èµ„è®¯</div>
                    <div id="newsContainer"><div class="loading">åŠ è½½ä¸­...</div></div>
                </div>
            </div>
        </div>
        
        <footer>Â© 2026 Ansun</footer>
    </div>
    
    <script src="marked.min.js"></script>
    <script>
        const API_BASE = '/api';
        
        // æ¨¡æ‹Ÿæ•°æ® - å®æ—¶è·å–çœŸå®æ•°æ®åä¼šæ›¿æ¢
        const signals = {
            'BTC': { signal: 'neutral', emoji: 'âšª', text: 'æŒæœ‰', desc: 'è§‚æœ›ç­‰å¾…', netFlow: '+3.2M', netFlowClass: 'up', whaleDetail: '2ç¬”ä¹°å…¥ / 1ç¬”å–å‡º', sentiment: 'ğŸ“ˆ æ­£é¢', sentimentDetail: '5æ¡ç›¸å…³æ–°é—»', price: '-2.3%', priceClass: 'down', why: ['å·¨é²¸èµ„é‡‘å‡€æµå…¥ $3.2M', 'æ–°é—»æŠ¥é“åæ­£é¢'], confidence: '68%' },
            'ETH': { signal: 'bullish', emoji: 'ğŸŸ¢', text: 'ä¹°å…¥', desc: 'å¯é€‚å½“å»ºä»“', netFlow: '+8.5M', netFlowClass: 'up', whaleDetail: '5ç¬”ä¹°å…¥ / 2ç¬”å–å‡º', sentiment: 'ğŸ“ˆ æ­£é¢', sentimentDetail: '8æ¡ç›¸å…³æ–°é—»', price: '+5.1%', priceClass: 'up', why: ['å·¨é²¸å¤§å¹…å‡€æµå…¥ $8.5M', 'DeFi TVL åˆ›å†å²æ–°é«˜'], confidence: '75%' },
            'SOL': { signal: 'bullish', emoji: 'ğŸŸ¢', text: 'ä¹°å…¥', desc: 'ç”Ÿæ€æ´»è·ƒ', netFlow: '+2.1M', netFlowClass: 'up', whaleDetail: '3ç¬”ä¹°å…¥ / 1ç¬”å–å‡º', sentiment: 'ğŸ“ˆ æ­£é¢', sentimentDetail: '4æ¡ç›¸å…³æ–°é—»', price: '+8.2%', priceClass: 'up', why: ['TVL å¢é•¿ 15%', 'æ–°é¡¹ç›®ä¸Šçº¿'], confidence: '72%' },
            'BNB': { signal: 'neutral', emoji: 'âšª', text: 'æŒæœ‰', desc: 'è§‚æœ›ä¸ºä¸»', netFlow: '-500K', netFlowClass: 'down', whaleDetail: '1ç¬”ä¹°å…¥ / 2ç¬”å–å‡º', sentiment: 'âš–ï¸ ä¸­æ€§', sentimentDetail: '2æ¡ç›¸å…³æ–°é—»', price: '-1.2%', priceClass: 'down', why: ['èµ„é‡‘å°å¹…å‡€æµå‡º', 'å¸‚åœºè§‚æœ›æƒ…ç»ª'], confidence: '55%' },
            'XRP': { signal: 'bearish', emoji: 'ğŸ”´', text: 'å–å‡º', desc: 'å»ºè®®å‡ä»“', netFlow: '-1.8M', netFlowClass: 'down', whaleDetail: '0ç¬”ä¹°å…¥ / 4ç¬”å–å‡º', sentiment: 'ğŸ“‰ è´Ÿé¢', sentimentDetail: '3æ¡ç›¸å…³æ–°é—»', price: '-4.5%', priceClass: 'down', why: ['å·¨é²¸æŒç»­å‡€æµå‡º', 'æ³•å¾‹çº çº·è´Ÿé¢å½±å“'], confidence: '70%' },
            'ADA': { signal: 'neutral', emoji: 'âšª', text: 'æŒæœ‰', desc: 'ç­‰å¾…çªç ´', netFlow: '+200K', netFlowClass: 'up', whaleDetail: '1ç¬”ä¹°å…¥ / 1ç¬”å–å‡º', sentiment: 'âš–ï¸ ä¸­æ€§', sentimentDetail: '1æ¡ç›¸å…³æ–°é—»', price: '+0.8%', priceClass: 'up', why: ['äº¤æ˜“é‡ä½è¿·', 'ç­‰å¾…æ–°æ¶ˆæ¯'], confidence: '50%' },
            'DOGE': { signal: 'neutral', emoji: 'âšª', text: 'æŒæœ‰', desc: 'æ³¢åŠ¨è¾ƒå¤§', netFlow: '+100K', netFlowClass: 'up', whaleDetail: '2ç¬”ä¹°å…¥ / 2ç¬”å–å‡º', sentiment: 'ğŸ“‰ è´Ÿé¢', sentimentDetail: '2æ¡ç›¸å…³æ–°é—»', price: '-3.1%', priceClass: 'down', why: ['ç¤¾åŒºæ´»è·ƒåº¦ä¸‹é™', 'é©¬æ–¯å…‹è¯é¢˜å‡å°‘'], confidence: '52%' },
            'AVAX': { signal: 'bullish', emoji: 'ğŸŸ¢', text: 'ä¹°å…¥', desc: 'ç”Ÿæ€å¢é•¿', netFlow: '+1.5M', netFlowClass: 'up', whaleDetail: '2ç¬”ä¹°å…¥ / 0ç¬”å–å‡º', sentiment: 'ğŸ“ˆ æ­£é¢', sentimentDetail: '3æ¡ç›¸å…³æ–°é—»', price: '+4.2%', priceClass: 'up', why: ['æœºæ„æŒç»­ä¹°å…¥', 'å­ç½‘ç”Ÿæ€æ‰©å±•'], confidence: '68%' }
        };
        
        function updateSignal() {
            const coin = document.getElementById('coinSelect').value;
            const data = signals[coin] || signals['BTC'];
            const main = document.getElementById('signalMain');
            main.className = 'signal-main signal-' + data.signal;
            document.getElementById('signalIcon').textContent = data.emoji;
            document.getElementById('signalRec').textContent = coin + ' ' + data.emoji + ' ' + data.text;
            document.getElementById('signalDesc').textContent = data.desc;
            document.getElementById('whaleNet').textContent = data.netFlow;
            document.getElementById('whaleNet').className = 'data-value ' + data.netFlowClass;
            document.getElementById('whaleDetail').textContent = data.whaleDetail;
            document.getElementById('sentiment').textContent = data.sentiment;
            document.getElementById('sentiment').className = 'data-value ' + (data.signal === 'bullish' ? 'up' : data.signal === 'bearish' ? 'down' : '');
            document.getElementById('sentimentDetail').textContent = data.sentimentDetail;
            document.getElementById('price').textContent = data.price;
            document.getElementById('price').className = 'data-value ' + data.priceClass;
            document.getElementById('priceDetail').textContent = coin + ' 24hæ¶¨è·Œå¹…';
            document.getElementById('signalWhy').innerHTML = data.why.map(r => '<div class="why-item">' + r + '</div>').join('');
            document.getElementById('confidence').textContent = 'AIç½®ä¿¡åº¦: ' + data.confidence;
            document.getElementById('updateTime').textContent = 'æ›´æ–°æ—¶é—´: ' + new Date().toLocaleString('zh-CN');
        }
        
        async function loadMarket() {
            try {
                const res = await fetch(API_BASE + '/price/top?limit=30');
                const data = await res.json();
                if (data.success) {
                    const btc = data.data.find(c => c.symbol === 'BTC');
                    const eth = data.data.find(c => c.symbol === 'ETH');
                    document.getElementById('marketHeader').innerHTML = '<div class="market-pill"><span class="label">BTC</span><span class="value">$' + (btc?.current_price || 0).toLocaleString() + '</span><span class="change ' + ((btc?.price_change_percentage_24h || 0) >= 0 ? 'up' : 'down') + '">' + ((btc?.price_change_percentage_24h || 0) >= 0 ? '+' : '') + (btc?.price_change_percentage_24h || 0).toFixed(2) + '%</span></div><div class="market-pill"><span class="label">ETH</span><span class="value">$' + (eth?.current_price || 0).toLocaleString() + '</span><span class="change ' + ((eth?.price_change_percentage_24h || 0) >= 0 ? 'up' : 'down') + '">' + ((eth?.price_change_percentage_24h || 0) >= 0 ? '+' : '') + (eth?.price_change_percentage_24h || 0).toFixed(2) + '%</span></div>';
                    document.getElementById('coinTable').innerHTML = data.data.slice(0, 10).map(c => '<tr><td class="coin-rank">' + (c.market_cap_rank || '-') + '</td><td><div class="coin-info"><img src="' + c.image + '" alt="' + c.name + '" onerror="this.style.display=\'none\'"><div><div class="name">' + c.name + '</div><div class="symbol">' + c.symbol + '</div></div></td><td class="coin-price">$' + (c.current_price || 0).toLocaleString() + '</td><td><span class="coin-change ' + ((c.price_change_percentage_24h || 0) >= 0 ? 'up' : 'down') + '">' + ((c.price_change_percentage_24h || 0) >= 0 ? '+' : '') + (c.price_change_percentage_24h || 0).toFixed(2) + '%</span></td><td><span class="coin-change ' + ((c.price_change_percentage_7d || 0) >= 0 ? 'up' : 'down') + '">' + ((c.price_change_percentage_7d || 0) >= 0 ? '+' : '') + (c.price_change_percentage_7d || 0).toFixed(2) + '%</span></td></tr>').join('');
                }
            } catch (e) { console.error('Market error:', e); }
        }
        
        async function loadNews() {
            try {
                const res = await fetch(API_BASE + '/news/zh?limit=8');
                const data = await res.json();
                if (data.success && data.data.length > 0) {
                    document.getElementById('newsContainer').innerHTML = data.data.map(item => '<div class="news-card" onclick="window.location.href=\'/article.html?id=' + encodeURIComponent(item.link) + '\'"><div class="news-meta"><span class="news-source">' + item.source + '</span><span class="news-time">' + formatTime(item.timestamp) + '</span></div><h4><a href="/article.html?id=' + encodeURIComponent(item.link) + '">' + item.title + '</a></h4><p>' + stripHtml(item.content).slice(0, 60) + '...</p></div>').join('');
                }
            } catch (e) { console.error('News error:', e); }
        }
        
        async function loadDashboard() {
            try {
                const res = await fetch(API_BASE + '/features/dashboard?lang=zh');
                const data = await res.json();
                if (data.success) {
                    document.getElementById('unlockCount').textContent = data.data.unlocks?.length || 0;
                    document.getElementById('narrativeCount').textContent = data.data.narratives?.length || 0;
                    document.getElementById('tvlValue').textContent = data.data.marketStats?.defiTvl || '-';
                    document.getElementById('whaleCount').textContent = '5';
                }
            } catch (e) { console.error('Dashboard error:', e); }
        }
        
        function formatTime(ts) { const d = (Date.now() - ts) / 1000 / 60; if (d < 60) return Math.floor(d) + 'åˆ†é’Ÿå‰'; if (d < 1440) return Math.floor(d / 60) + 'å°æ—¶å‰'; return Math.floor(d / 1440) + 'å¤©å‰'; }
        function stripHtml(h) { return h?.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim() || ''; }
        async function askAI() { const q = document.getElementById('aiInput').value.trim(); if (!q) return; alert('AIåŠŸèƒ½æ¼”ç¤º: ' + q); document.getElementById('aiInput').value = ''; }
        
        // åˆå§‹åŒ–
        updateSignal();
        loadMarket();
        loadNews();
        loadDashboard();
    </script>
</body>
</html>
