<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansun - åŠ å¯†è´§å¸èµ„è®¯å¹³å°</title>
    <meta name="theme-color" content="#0d1117">
    <meta name="description" content="AIé©±åŠ¨çš„åŠ å¯†è´§å¸èµ„è®¯ã€å·¨é²¸è¿½è¸ªã€æ¦‚å¿µè½®åŠ¨åˆ†æå¹³å°">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0d1117; color: #c9d1d9; min-height: 100vh; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid #30363d; margin-bottom: 16px; }
        header h1 { font-size: 1.4rem; font-weight: 700; background: linear-gradient(135deg, #58a6ff, #8b949e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .lang-select { padding: 6px 10px; border-radius: 6px; border: 1px solid #30363d; background: #21262d; color: #c9d1d9; cursor: pointer; }
        .tab-nav { display: flex; gap: 8px; margin-bottom: 16px; overflow-x: auto; padding-bottom: 8px; }
        .tab-btn { padding: 10px 16px; border-radius: 8px; border: 1px solid #30363d; background: #161b22; color: #8b949e; white-space: nowrap; cursor: pointer; transition: all 0.2s; font-size: 0.9rem; }
        .tab-btn.active { background: #1f6feb; border-color: #1f6feb; color: #fff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .signal-card, .section-card { background: linear-gradient(145deg, #21262d, #161b22); border: 1px solid #30363d; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
        .section-title { font-size: 1rem; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .signal-main { display: flex; align-items: center; gap: 14px; margin-bottom: 14px; }
        .signal-icon { width: 56px; height: 56px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 26px; background: #21262d; }
        .signal-buy .signal-icon { background: rgba(63, 185, 80, 0.2); }
        .signal-sell .signal-icon { background: rgba(248, 81, 73, 0.2); }
        .signal-hold .signal-icon { background: rgba(139, 148, 158, 0.2); }
        .signal-info { flex: 1; }
        .signal-recommendation { font-size: 1.5rem; font-weight: 700; }
        .signal-buy .signal-recommendation { color: #3fb950; }
        .signal-sell .signal-recommendation { color: #f85149; }
        .signal-hold .signal-recommendation { color: #8b949e; }
        .signal-desc { font-size: 0.8rem; color: #8b949e; }
        .signal-data-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 14px; }
        .data-item { background: #0d1117; border-radius: 8px; padding: 12px; text-align: center; }
        .data-value { font-size: 1rem; font-weight: 700; }
        .data-value.up { color: #3fb950; }
        .data-value.down { color: #f85149; }
        .data-sub { font-size: 0.7rem; color: #8b949e; margin-top: 4px; }
        .why-box { background: #21262d; border-radius: 8px; padding: 12px; margin-bottom: 12px; }
        .why-title { font-weight: 600; font-size: 0.85rem; margin-bottom: 8px; color: #58a6ff; }
        .why-item { font-size: 0.85rem; color: #c9d1d9; margin-bottom: 6px; padding-left: 16px; position: relative; }
        .why-item::before { content: 'â†’'; position: absolute; left: 0; color: #58a6ff; }
        .coin-select { margin-left: 10px; padding: 4px 8px; border-radius: 6px; border: 1px solid #30363d; background: #21262d; color: #c9d1d9; font-size: 0.85rem; }
        .quick-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 16px; }
        .quick-stat { background: #161b22; border: 1px solid #30363d; border-radius: 10px; padding: 12px; text-align: center; cursor: pointer; }
        .quick-stat:hover { border-color: #58a6ff; }
        .quick-stat .icon { font-size: 1.5rem; margin-bottom: 6px; }
        .quick-stat .label { font-size: 0.8rem; color: #8b949e; }
        .quick-stat .value { font-size: 0.9rem; font-weight: 600; margin-top: 4px; }
        .market-header { display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
        .market-pill { display: flex; align-items: center; gap: 6px; padding: 6px 10px; background: #21262d; border-radius: 6px; }
        .up { color: #3fb950; }
        .down { color: #f85149; }
        .news-card { background: #21262d; border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: pointer; }
        .news-card:hover { background: #30363d; }
        .news-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .news-source { background: #238636; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; color: #fff; }
        .news-time { color: #8b949e; font-size: 0.75rem; }
        .news-title { font-size: 0.9rem; font-weight: 600; line-height: 1.4; }
        .news-title a { color: #c9d1d9; text-decoration: none; }
        .alert-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #21262d; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #58a6ff; }
        .alert-item.critical { border-left-color: #f85149; background: rgba(248, 81, 73, 0.1); }
        .alert-item.high { border-left-color: #d29922; }
        .alert-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; background: #161b22; }
        .alert-info { flex: 1; }
        .alert-title { font-weight: 600; font-size: 0.9rem; margin-bottom: 2px; }
        .alert-detail { font-size: 0.8rem; color: #8b949e; }
        .alert-value { font-size: 1rem; font-weight: 700; }
        .alert-value.up { color: #3fb950; }
        .alert-value.down { color: #f85149; }
        .alert-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; }
        .alert-badge.critical { background: rgba(248, 81, 73, 0.2); color: #f85149; }
        .alert-badge.high { background: rgba(210, 153, 34, 0.2); color: #d29922; }
        .narrative-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .narrative-card { background: #21262d; border-radius: 10px; padding: 14px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; border: 1px solid #30363d; }
        .narrative-card:hover { border-color: #58a6ff; background: #30363d; }
        .n-header { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
        .n-icon { font-size: 1.3rem; }
        .n-name { font-weight: 600; font-size: 0.95rem; }
        .n-desc { font-size: 0.8rem; color: #8b949e; line-height: 1.4; }
        .n-trend { font-size: 0.75rem; padding: 2px 8px; border-radius: 10px; margin-left: auto; }
        .n-trend.hot { background: rgba(248, 81, 73, 0.2); color: #f85149; }
        .n-trend.rising { background: rgba(210, 153, 34, 0.2); color: #d29922; }
        .n-trend.stable { background: rgba(139, 148, 158, 0.2); color: #8b949e; }
        .n-trend.cooling { background: rgba(88, 166, 255, 0.2); color: #58a6ff; }
        .n-stats { display: flex; gap: 12px; font-size: 0.75rem; color: #8b949e; }
        .n-insight-box { background: linear-gradient(135deg, #21262d, #161b22); border: 1px solid #30363d; border-radius: 10px; padding: 14px; margin-bottom: 16px; }
        .n-insight-title { font-size: 0.85rem; font-weight: 600; margin-bottom: 10px; color: #58a6ff; }
        .n-insight-item { padding: 8px 12px; border-radius: 6px; margin-bottom: 6px; font-size: 0.85rem; }
        .n-insight-item.good { background: rgba(63, 185, 80, 0.1); color: #3fb950; }
        .n-insight-item.bad { background: rgba(248, 81, 73, 0.1); color: #f85149; }
        .n-bar-bg { background: #161b22; border-radius: 4px; height: 8px; margin: 10px 0 6px; overflow: hidden; }
        .n-bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; }
        .feed-settings { background: #21262d; border-radius: 8px; padding: 12px; margin-bottom: 12px; }
        .feed-coins { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
        .coin-tag { padding: 6px 12px; border-radius: 20px; border: 1px solid #30363d; background: #161b22; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; }
        .coin-tag.selected { background: #1f6feb; border-color: #1f6feb; color: #fff; }
        .feed-empty { text-align: center; padding: 30px; color: #8b949e; }
        .loading { text-align: center; padding: 30px; color: #8b949e; }
        .loading::after { content: ''; display: inline-block; width: 20px; height: 20px; border: 2px solid #30363d; border-top-color: #58a6ff; border-radius: 50%; animation: spin 0.8s linear infinite; margin-left: 8px; vertical-align: middle; }
        @keyframes spin { to { transform: rotate(360deg); } }
        footer { text-align: center; padding: 16px; border-top: 1px solid #30363d; color: #8b949e; font-size: 0.8rem; margin-top: 16px; }
        @media (max-width: 600px) { .quick-stats { grid-template-columns: repeat(2, 1fr); } .signal-data-grid { grid-template-columns: 1fr; } .narrative-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Ansun</h1>
            <select class="lang-select" id="langSelect">
                <option value="zh">ä¸­æ–‡</option>
                <option value="en">English</option>
            </select>
        </header>
        
        <div class="tab-nav">
            <button class="tab-btn active" onclick="showTab('signal')">ğŸ“ˆ AIä¿¡å·</button>
            <button class="tab-btn" onclick="showTab('whale')">ğŸ‹ å·¨é²¸è¿½è¸ª</button>
            <button class="tab-btn" onclick="showTab('narratives')">ğŸ”¥ æ¦‚å¿µè½®åŠ¨</button>
            <button class="tab-btn" onclick="showTab('feed')">â­ æˆ‘çš„å…³æ³¨</button>
        </div>
        
        <div id="tab-signal" class="tab-content active">
            <div class="signal-card">
                <div class="section-title">ğŸ“ˆ AIå¸‚åœºä¿¡å· <select id="signalCoin" class="coin-select" onchange="updateSignal()"><option value="BTC">BTC</option><option value="ETH">ETH</option><option value="SOL">SOL</option><option value="BNB">BNB</option><option value="XRP">XRP</option><option value="ADA">ADA</option><option value="DOGE">DOGE</option><option value="AVAX">AVAX</option></select></div>
                <div class="signal-main" id="signalMain">
                    <div class="signal-icon" id="signalIcon">ğŸ“Š</div>
                    <div class="signal-info">
                        <div class="signal-recommendation" id="signalRec">åŠ è½½ä¸­...</div>
                        <div class="signal-desc" id="signalDesc">æ­£åœ¨åˆ†æå¸‚åœºæ•°æ®</div>
                    </div>
                </div>
                <div class="signal-data-grid">
                    <div class="data-item"><div class="data-value" id="whaleNet">-</div><div class="data-sub">ğŸ‹ å·¨é²¸èµ„é‡‘</div></div>
                    <div class="data-item"><div class="data-value" id="sentiment">-</div><div class="data-sub">ğŸ“° æ–°é—»æƒ…ç»ª</div></div>
                    <div class="data-item"><div class="data-value" id="price">-</div><div class="data-sub">ğŸ’° 24hæ¶¨è·Œå¹…</div></div>
                </div>
                <div class="why-box"><div class="why-title">ğŸ“‹ AIåˆ†æç†ç”±</div><div id="signalWhy">åŠ è½½ä¸­...</div></div>
            </div>
            
            <div class="quick-stats">
                <div class="quick-stat"><div class="icon">ğŸ””</div><div class="label">ä»£å¸è§£é”</div><div class="value" id="unlockCount">-</div><div class="sub">æœ¬æœˆ</div></div>
                <div class="quick-stat"><div class="icon">ğŸ“°</div><div class="label">æœ€æ–°èµ„è®¯</div><div class="value" id="newsCount">-</div><div class="sub">å®æ—¶</div></div>
                <div class="quick-stat"><div class="icon">ğŸ‹</div><div class="label">å·¨é²¸è¿½è¸ª</div><div class="value" id="whaleAlertCount">-</div><div class="sub">æ´»è·ƒ</div></div>
                <div class="quick-stat"><div class="icon">ğŸ“Š</div><div class="label">DeFi TVL</div><div class="value" id="tvlValue">-</div><div class="sub">é“¾ä¸Š</div></div>
            </div>
            
            <div class="section-card">
                <div class="section-title">ğŸ“Š å®æ—¶è¡Œæƒ…</div>
                <div class="market-header" id="marketHeader"><div class="loading">åŠ è½½ä¸­...</div></div>
                <div id="marketList"><div class="loading">åŠ è½½ä¸­...</div></div>
            </div>
            
            <div class="section-card">
                <div class="section-title">ğŸ“° æœ€æ–°èµ„è®¯</div>
                <div id="newsList"><div class="loading">åŠ è½½ä¸­...</div></div>
            </div>
        </div>
        
        <div id="tab-whale" class="tab-content">
            <div class="section-card">
                <div class="section-title">ğŸ”” å·¨é²¸å®æ—¶æé†’</div>
                <div id="alertList"><div class="loading">åŠ è½½ä¸­...</div></div>
            </div>
        </div>
        
        <div id="tab-narratives" class="tab-content">
            <div class="section-card">
                <div class="section-title">ğŸ”¥ æ¦‚å¿µè½®åŠ¨åˆ†æ</div>
                <div class="n-insight-box">
                    <div class="n-insight-title">ğŸ’¡ AI æ“ä½œå»ºè®®</div>
                    <div id="narrativeInsight" style="font-size:0.85rem;color:#8b949e">åŠ è½½ä¸­...</div>
                </div>
                <div class="section-title" style="font-size:0.9rem;margin-bottom:12px">ğŸ“Š æ¦‚å¿µçƒ­åº¦æ¦œ</div>
                <div id="narrativeGrid"><div class="loading">åŠ è½½ä¸­...</div></div>
            </div>
        </div>
        
        <div id="tab-feed" class="tab-content">
            <div class="section-card">
                <div class="section-title">â­ æˆ‘çš„å…³æ³¨è®¾ç½®</div>
                <div class="feed-settings">
                    <div style="font-size:0.85rem;color:#8b949e;margin-bottom:8px">é€‰æ‹©ä½ æƒ³å…³æ³¨çš„å¸ç§ï¼ˆæœ€å¤š5ä¸ªï¼‰ï¼š</div>
                    <div class="feed-coins" id="coinTags">
                        <span class="coin-tag" onclick="toggleCoin(this, 'BTC')">BTC</span>
                        <span class="coin-tag" onclick="toggleCoin(this, 'ETH')">ETH</span>
                        <span class="coin-tag" onclick="toggleCoin(this, 'SOL')">SOL</span>
                        <span class="coin-tag" onclick="toggleCoin(this, 'BNB')">BNB</span>
                        <span class="coin-tag" onclick="toggleCoin(this, 'XRP')">XRP</span>
                        <span class="coin-tag" onclick="toggleCoin(this, 'ADA')">ADA</span>
                        <span class="coin-tag" onclick="toggleCoin(this, 'DOGE')">DOGE</span>
                        <span class="coin-tag" onclick="toggleCoin(this, 'AVAX')">AVAX</span>
                        <span class="coin-tag" onclick="toggleCoin(this, 'MATIC')">MATIC</span>
                        <span class="coin-tag" onclick="toggleCoin(this, 'LINK')">LINK</span>
                    </div>
                </div>
            </div>
            
            <div class="section-card">
                <div class="section-title">ğŸ“° å…³æ³¨çš„èµ„è®¯</div>
                <div id="feedNews"><div class="feed-empty"><div class="icon">ğŸ“°</div><div>å…³æ³¨å¸ç§åæ˜¾ç¤ºç›¸å…³å†…å®¹</div></div></div>
            </div>
            
            <div class="section-card">
                <div class="section-title">ğŸ‹ å·¨é²¸åŠ¨æ€</div>
                <div id="feedWhale"><div class="feed-empty"><div class="icon">ğŸ‹</div><div>å…³æ³¨å¸ç§åæ˜¾ç¤ºå·¨é²¸åŠ¨æ€</div></div></div>
            </div>
        </div>
        
        <footer>Â© 2026 Ansun - AIé©±åŠ¨çš„åŠ å¯†è´§å¸èµ„è®¯å¹³å°</footer>
    </div>
    
    <script src="marked.min.js"></script>
    <script>
        const API_BASE = '/api';
        const STORAGE_KEY = 'ansun_followed_coins';
        const signalData = {
            'BTC': { signal: 'neutral', emoji: 'âšª', text: 'æŒæœ‰', desc: 'è§‚æœ›ç­‰å¾…', netFlow: '+3.2M', netFlowClass: 'up', sentiment: 'ğŸ“ˆ æ­£é¢', price: '-2.3%', priceClass: 'down', why: ['å·¨é²¸èµ„é‡‘å‡€æµå…¥ $3.2M', 'æ–°é—»æŠ¥é“åæ­£é¢'], confidence: '68%' },
            'ETH': { signal: 'bullish', emoji: 'ğŸŸ¢', text: 'ä¹°å…¥', desc: 'å¯é€‚å½“å»ºä»“', netFlow: '+8.5M', netFlowClass: 'up', sentiment: 'ğŸ“ˆ æ­£é¢', price: '+5.1%', priceClass: 'up', why: ['å·¨é²¸å¤§å¹…å‡€æµå…¥ $8.5M', 'DeFi TVL åˆ›å†å²æ–°é«˜'], confidence: '75%' },
            'SOL': { signal: 'bullish', emoji: 'ğŸŸ¢', text: 'ä¹°å…¥', desc: 'ç”Ÿæ€æ´»è·ƒ', netFlow: '+2.1M', netFlowClass: 'up', sentiment: 'ğŸ“ˆ æ­£é¢', price: '+8.2%', priceClass: 'up', why: ['TVL å¢é•¿ 15%', 'æ–°é¡¹ç›®ä¸Šçº¿'], confidence: '72%' },
            'BNB': { signal: 'neutral', emoji: 'âšª', text: 'æŒæœ‰', desc: 'è§‚æœ›ä¸ºä¸»', netFlow: '-500K', netFlowClass: 'down', sentiment: 'âš–ï¸ ä¸­æ€§', price: '-1.2%', priceClass: 'down', why: ['èµ„é‡‘å°å¹…å‡€æµå‡º', 'å¸‚åœºè§‚æœ›æƒ…ç»ª'], confidence: '55%' },
            'XRP': { signal: 'bearish', emoji: 'ğŸ”´', text: 'å–å‡º', desc: 'å»ºè®®å‡ä»“', netFlow: '-1.8M', netFlowClass: 'down', sentiment: 'ğŸ“‰ è´Ÿé¢', price: '-4.5%', priceClass: 'down', why: ['å·¨é²¸æŒç»­å‡€æµå‡º', 'æ³•å¾‹çº çº·è´Ÿé¢å½±å“'], confidence: '70%' },
            'ADA': { signal: 'neutral', emoji: 'âšª', text: 'æŒæœ‰', desc: 'ç­‰å¾…çªç ´', netFlow: '+200K', netFlowClass: 'up', sentiment: 'âš–ï¸ ä¸­æ€§', price: '+0.8%', priceClass: 'up', why: ['äº¤æ˜“é‡ä½è¿·', 'ç­‰å¾…æ–°æ¶ˆæ¯'], confidence: '50%' },
            'DOGE': { signal: 'neutral', emoji: 'âšª', text: 'æŒæœ‰', desc: 'æ³¢åŠ¨è¾ƒå¤§', netFlow: '+100K', netFlowClass: 'up', sentiment: 'ğŸ“‰ è´Ÿé¢', price: '-3.1%', priceClass: 'down', why: ['ç¤¾åŒºæ´»è·ƒåº¦ä¸‹é™', 'é©¬æ–¯å…‹è¯é¢˜å‡å°‘'], confidence: '52%' },
            'AVAX': { signal: 'bullish', emoji: 'ğŸŸ¢', text: 'ä¹°å…¥', desc: 'ç”Ÿæ€å¢é•¿', netFlow: '+1.5M', netFlowClass: 'up', sentiment: 'ğŸ“ˆ æ­£é¢', price: '+4.2%', priceClass: 'up', why: ['æœºæ„æŒç»­ä¹°å…¥', 'å­ç½‘ç”Ÿæ€æ‰©å±•'], confidence: '68%' }
        };
        
        let followedCoins = JSON.parse(localStorage.getItem(STORAGE_KEY) || '["BTC", "ETH"]');
        
        function init() {
            updateSignal();
            loadMarket();
            loadNews();
            loadWhaleAlerts();
            loadNarratives();
            updateFollowedCoins();
        }
        
        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            event.target.classList.add('active');
        }
        
        function updateSignal() {
            const coin = document.getElementById('signalCoin').value;
            const data = signalData[coin] || signalData['BTC'];
            const main = document.getElementById('signalMain');
            main.className = 'signal-main signal-' + data.signal;
            document.getElementById('signalIcon').textContent = data.emoji;
            document.getElementById('signalRec').textContent = coin + ' ' + data.emoji + ' ' + data.text;
            document.getElementById('signalDesc').textContent = data.desc;
            document.getElementById('whaleNet').textContent = data.netFlow;
            document.getElementById('whaleNet').className = 'data-value ' + data.netFlowClass;
            document.getElementById('sentiment').textContent = data.sentiment;
            document.getElementById('price').textContent = data.price;
            document.getElementById('price').className = 'data-value ' + data.priceClass;
            document.getElementById('signalWhy').innerHTML = data.why.map(w => '<div class="why-item">' + w + '</div>').join('');
        }
        
        async function loadMarket() {
            document.getElementById('unlockCount').textContent = '12';
            document.getElementById('newsCount').textContent = '5';
            document.getElementById('whaleAlertCount').textContent = '3';
            document.getElementById('tvlValue').textContent = '$98.5B';
            try {
                const res = await fetch(API_BASE + '/price/top?limit=10');
                const data = await res.json();
                if (data.success) {
                    const btc = data.data.find(c => c.symbol === 'BTC');
                    const eth = data.data.find(c => c.symbol === 'ETH');
                    document.getElementById('marketHeader').innerHTML = '<div class="market-pill"><span class="label">BTC</span><span>$' + (btc?.current_price || 0).toLocaleString() + '</span><span class="' + ((btc?.price_change_percentage_24h || 0) >= 0 ? 'up' : 'down') + '">' + ((btc?.price_change_percentage_24h || 0) >= 0 ? '+' : '') + (btc?.price_change_percentage_24h || 0).toFixed(2) + '%</span></div><div class="market-pill"><span class="label">ETH</span><span>$' + (eth?.current_price || 0).toLocaleString() + '</span><span class="' + ((eth?.price_change_percentage_24h || 0) >= 0 ? 'up' : 'down') + '">' + ((eth?.price_change_percentage_24h || 0) >= 0 ? '+' : '') + (eth?.price_change_percentage_24h || 0).toFixed(2) + '%</span></div>';
                    document.getElementById('marketList').innerHTML = data.data.slice(0, 8).map(c => '<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #21262d;font-size:0.85rem"><span><img src="' + c.image + '" style="width:20px;height:20px;border-radius:50%;vertical-align:middle;margin-right:8px">' + c.name + '</span><span><span style="font-weight:600">$' + (c.current_price || 0).toLocaleString() + '</span> <span class="' + ((c.price_change_percentage_24h || 0) >= 0 ? 'up' : 'down') + '" style="font-size:0.8rem">' + ((c.price_change_percentage_24h || 0) >= 0 ? '+' : '') + (c.price_change_percentage_24h || 0).toFixed(2) + '%</span></span></div>').join('');
                }
            } catch (e) { console.error('Market error:', e); }
        }
        
        async function loadNews() {
            try {
                const res = await fetch(API_BASE + '/news/zh?limit=10');
                const data = await res.json();
                if (data.success && data.data.length > 0) {
                    document.getElementById('newsList').innerHTML = data.data.slice(0, 5).map(n => '<div class="news-card" onclick="window.location.href=\'/article.html?id=' + encodeURIComponent(n.link) + '\'"><div class="news-meta"><span class="news-source">' + n.source + '</span><span class="news-time">' + formatTime(n.timestamp) + '</span></div><div class="news-title"><a href="/article.html?id=' + encodeURIComponent(n.link) + '">' + n.title + '</a></div></div>').join('');
                }
            } catch (e) { console.error('News error:', e); }
        }
        
        function loadWhaleAlerts() {
            const alerts = [
                { address: 'CZ', token: 'BTC', value: 2500, value_usd: 187500000, action: 'sent', importance: 'critical', time: '30åˆ†é’Ÿå‰' },
                { address: 'Vitalik', token: 'ETH', value: 5000, value_usd: 11300000, action: 'sent', importance: 'high', time: '1å°æ—¶å‰' },
                { address: 'Binance', token: 'USDT', value: 50000000, value_usd: 50000000, action: 'received', importance: 'high', time: '2å°æ—¶å‰' },
                { address: 'Justin Sun', token: 'TRX', value: 10000000, value_usd: 2100000, action: 'sent', importance: 'normal', time: '3å°æ—¶å‰' }
            ];
            document.getElementById('alertList').innerHTML = alerts.map(a => '<div class="alert-item ' + a.importance + '"><div class="alert-icon">' + (a.action === 'sent' ? 'ğŸ“¤' : 'ğŸ“¥') + '</div><div class="alert-info"><div class="alert-title">' + a.address + ' è½¬å‡º ' + a.token + '</div><div class="alert-detail">' + a.token + ' Â· ' + a.time + '</div></div><div class="alert-value ' + (a.action === 'sent' ? 'down' : 'up') + '">' + formatLargeNumber(a.value) + '</div><div class="alert-badge ' + a.importance + '">' + (a.importance === 'critical' ? 'ğŸ”´ é‡å¤§' : a.importance === 'high' ? 'ğŸŸ  å¤§é¢' : 'ğŸŸ¡ ç›‘æ§') + '</div></div>').join('');
        }
        
        function loadNarratives() {
            const narratives = [
                { name: 'AI + Crypto', icon: 'ğŸ¤–', trend: 'up', trendScore: 15, score: 85, reason: 'OpenAIã€GPUéœ€æ±‚å¤§æ¶¨', action: 'å¯è¿½æ¶¨' },
                { name: 'Memecoin', icon: 'ğŸ•', trend: 'up', trendScore: 12, score: 78, reason: 'PEPEã€DOGE ç¤¾åŒºçƒ­åº¦é«˜', action: 'è½»ä»“å‚ä¸' },
                { name: 'RWA', icon: 'ğŸ“‹', trend: 'up', trendScore: 8, score: 72, reason: 'è´è±å¾·ç­‰æœºæ„æŒç»­å…¥åœº', action: 'é€¢ä½å¸ƒå±€' },
                { name: 'Restaking', icon: 'ğŸ”’', trend: 'up', trendScore: 5, score: 65, reason: 'Eigenlayer æ¨åŠ¨ç”Ÿæ€', action: 'æŒæœ‰' },
                { name: 'DeFi', icon: 'ğŸ’°', trend: 'stable', trendScore: 0, score: 55, reason: 'TVL ç¨³å®šåœ¨ $50B', action: 'æŒæœ‰è§‚æœ›' },
                { name: 'Layer 2', icon: 'ğŸ”·', trend: 'down', trendScore: -10, score: 40, reason: 'Gasä¸‹é™ã€äº¤æ˜“é‡å‡å°‘', action: 'å›é¿' },
                { name: 'Gaming', icon: 'ğŸ®', trend: 'down', trendScore: -5, score: 35, reason: 'æ–°æ¸¸æˆä¸Šçº¿å°‘', action: 'è§‚æœ›' }
            ];
            
            // æŒ‰çƒ­åº¦æ’åº
            narratives.sort((a, b) => b.score - a.score);
            
            // AIå»ºè®®
            const hot = narratives.filter(n => n.trend === 'up' && n.score > 60);
            const cold = narratives.filter(n => n.trend === 'down' || n.score < 40);
            
            let insight = '';
            if (hot.length > 0) {
                insight += '<div style="color:#3fb950;margin-bottom:8px">ğŸŸ¢ å¯å…³æ³¨: ' + hot.map(n => n.name).join('ã€') + '</div>';
            }
            if (cold.length > 0) {
                insight += '<div style="color:#f85149">ğŸ”´ å›é¿: ' + cold.map(n => n.name).join('ã€') + '</div>';
            }
            document.getElementById('narrativeInsight').innerHTML = insight;
            
            // æ¦‚å¿µå¡ç‰‡
            let html = '';
            narratives.forEach(n => {
                const trendIcon = n.trend === 'up' ? 'ğŸ“ˆ' : n.trend === 'down' ? 'ğŸ“‰' : 'â¡ï¸';
                const trendText = n.trend === 'up' ? 'ä¸Šå‡ä¸­' : n.trend === 'down' ? 'é™æ¸©ä¸­' : 'å¹³ç¨³';
                const actionColor = n.action.includes('è¿½') || n.action.includes('å¸ƒå±€') ? '#3fb950' : n.action.includes('å›é¿') ? '#f85149' : '#8b949e';
                const barWidth = Math.min(n.score, 100);
                const barColor = n.score > 70 ? '#f85149' : n.score > 50 ? '#d29922' : '#58a6ff';
                
                html += '<div class="narrative-card">';
                html += '<div class="n-header">';
                html += '<span class="n-icon">' + n.icon + '</span>';
                html += '<span class="n-name">' + n.name + '</span>';
                html += '<span style="margin-left:auto;font-size:0.8rem;color:' + actionColor + '">' + n.action + '</span>';
                html += '</div>';
                html += '<div style="font-size:0.75rem;color:#8b949e;margin-bottom:8px">' + trendIcon + ' ' + trendText + ' Â· ' + n.reason + '</div>';
                html += '<div style="background:#161b22;border-radius:4px;height:6px;margin-bottom:4px">';
                html += '<div style="background:' + barColor + ';width:' + barWidth + '%;height:100%;border-radius:4px;transition:width 0.3s"></div>';
                html += '</div>';
                html += '<div style="display:flex;justify-content:space-between;font-size:0.7rem;color:#8b949e">';
                html += '<span>çƒ­åº¦ ' + n.score + '</span>';
                html += '<span>' + (n.score > 70 ? 'ğŸ”¥ çƒ­é—¨' : n.score > 50 ? 'ğŸ“Š å…³æ³¨' : 'ğŸ“‰ å†·é—¨') + '</span>';
                html += '</div>';
                html += '</div>';
            });
            document.getElementById('narrativeGrid').innerHTML = html;
        }
        
        function updateFollowedCoins() {
            document.querySelectorAll('.coin-tag').forEach(tag => {
                const coin = tag.textContent;
                tag.classList.toggle('selected', followedCoins.includes(coin));
            });
            loadPersonalizedFeed();
        }
        
        function toggleCoin(el, coin) {
            if (followedCoins.includes(coin)) {
                followedCoins = followedCoins.filter(c => c !== coin);
            } else if (followedCoins.length < 5) {
                followedCoins.push(coin);
            }
            localStorage.setItem(STORAGE_KEY, JSON.stringify(followedCoins));
            updateFollowedCoins();
        }
        
        function loadPersonalizedFeed() {
            if (followedCoins.length === 0) {
                document.getElementById('feedNews').innerHTML = '<div class="feed-empty"><div class="icon">ğŸ“°</div><div>è¯·è‡³å°‘å…³æ³¨ä¸€ä¸ªå¸ç§</div></div>';
                document.getElementById('feedWhale').innerHTML = '<div class="feed-empty"><div class="icon">ğŸ‹</div><div>è¯·è‡³å°‘å…³æ³¨ä¸€ä¸ªå¸ç§</div></div>';
                return;
            }
            document.getElementById('feedNews').innerHTML = '<div class="loading">åŠ è½½' + followedCoins.join(', ') + 'ç›¸å…³å†…å®¹...</div>';
            document.getElementById('feedWhale').innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
        }
        
        function formatTime(ts) { const d = (Date.now() - ts) / 1000 / 60; if (d < 60) return Math.floor(d) + 'åˆ†é’Ÿå‰'; if (d < 1440) return Math.floor(d / 60) + 'å°æ—¶å‰'; return Math.floor(d / 1440) + 'å¤©å‰'; }
        function formatLargeNumber(n) { if (n >= 1000000) return '$' + (n / 1000000).toFixed(1) + 'M'; if (n >= 1000) return '$' + (n / 1000).toFixed(1) + 'K'; return '$' + n; }
        
        init();
    </script>
</body>
</html>
